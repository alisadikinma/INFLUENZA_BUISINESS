version: "2.4.0"

pattern_ref_prefix: '!RAG_CORE_MODULES'

compiled_from:
  - Hook Template Bank v3.8.2
  - Script Format Blueprint v3.8.2
  - Viral Script Analysis Enhancement v1.0
  - Cultural Research Integration 2024-2025
  - Dual Format System Implementation
  - Universal Platform Optimization

default_tone:
  baseline_emotional_state: curious_engagement_with_cultural_authenticity
  indonesian_gen_z_markers:
    - natural_code_switching_indonesian_english
    - playful_slang_with_respectful_boundaries
    - meme_friendly_phrasing
    - current_slang_2024_2025: ["anjay", "anjir", "rilcuy", "markicob"]
    - cultural_phenomena_integration: ["rojali", "mindful_consumption", "guyub_values"]
    - authentic_relatability_priority: "real, raw, relatable over polished"

voice_constraints:
  no_preachy: true
  no_too_formal: true
  no_excessive_emoji: true

tone_transitions:
  - from: curious
    to: surprised
    trigger: fact_reveal
  - from: surprised
    to: clarified
    trigger: explain_clearly

# ENHANCED: Dual Format System Support
format_selection_logic:
  30s_relate_triggers:
    - cultural_observation_input
    - daily_life_business_query
    - kenapa_pattern: "kenapa [brand] [behavior]"
    - relate_feeling_request
    - rojali_phenomenon_references
    - choice_engagement_scenarios

  60s_education_triggers:
    - explicit_business_strategy_request
    - framework_education_need
    - numbered_strategy_request
    - gimana_cara_pattern: "gimana cara [business_goal]"
    - comprehensive_learning_request
    - creator_insights_request

universal_platform_optimization:
  single_content_multiple_platforms: "Instagram/TikTok/YouTube"
  platform_specific_emphasis: "presentation adaptation only"
  cross_platform_hashtags: "universal + platform additions"
  cultural_authenticity_universal: "Indonesian Gen Z voice resonates all platforms"
  attention_span_reality: "8 seconds average, 3 seconds hook window"

# ENHANCED: Hook patterns with viral script structures + cultural integration
hook_patterns:
  # Cultural Connection Patterns (30s relate format)
  rojali_phenomenon:
    template: "Rojali (rombongan jarang beli) [relatability_question]"
    cultural_context: "40% mall traffic doesn't convert to sales"
    engagement_trigger: "Lo pernah jadi rojali nggak?"
    guardrails:
      - acknowledge_economic_pressures
      - maintain_gentle_humor

  brand_switching_cultural:
    template: "[current_slang] 43% Gen Z ganti brand tiap 1-3 bulan. [relate_question]"
    cultural_insight: "economic sophistication and price sensitivity"
    choice_scenario: "Tim brand loyal atau tim praktis ganti-ganti?"

  mindful_consumption_shift:
    template: "73% Gen Z pilih mindful consumption over FOMO. [values_alignment]"
    cultural_evolution: "FOMO redefined as 'Filter On My Own'"
    community_focus: "Tim mindful vs Tim FOMO culture"

  # Traditional patterns enhanced with cultural sensitivity
  myth_bust:
    template: Bukan [assumption], tapi [reality]
    guardrails:
      - no_unverified_claims
      - cultural_sensitivity_indonesia

  counter_intuitive:
    template: Semakin [X], malah [Y]
    cultural_integration: "indonesian_market_examples"

  what_if:
    template: Gimana kalau [scenario]?
    slang_integration: "natural_current_slang_usage"

  stat_shock:
    template: '[credible_number]% dari [group] [finding]'
    requires_citation: true
    cultural_relevance: "indonesian_gen_z_context_priority"

  # ENHANCED: Cultural integration patterns
  numbered_countdown:
    template: "[number] [mistake_type] [target_group] yang bikin [negative_outcome]"
    structure: "countdown format (4→3→2→1)"
    cultural_sensitivity: "guyub community values integration"
    guardrails:
      - maintain_educational_value
      - avoid_shaming_language
      - respect_economic_class_differences
    examples:
      - "4 kesalahan pebisnis Gen Z yang bikin usaha mereka sepi pembeli"
      - "3 alasan rojali phenomenon actually smart for Indonesian economy"

  authority_framework:
    template: "Aku pernah [experience] di [authority_context] dan [insight_statement]"
    structure: "experience establishment + framework delivery"
    creator_pattern_alignment: "natural storytelling like Maudy Ayunda, Samuel Christ approach"
    guardrails:
      - verify_experience_claims
      - provide_actionable_insights
      - avoid_signature_taglines: "1 miliar pertama"
      - maintain_cultural_authenticity
    examples:
      - "Aku pernah kerja di salah satu perusahaan FMCG terbesar di Indonesia dan hanya ada tiga cara untuk nge-grow bisnis kamu"
      - "Berdasarkan pengalaman gue, 79% Gen Z factor values into purchase decisions..."

  conspiracy_reveal:
    template: "[relatable_setup] Apakah ini [question] atau [alternative_theory]?"
    structure: "setup + question + theory + broader lesson"
    guardrails:
      - maintain_educational_focus
      - avoid_harmful_conspiracy_theories
    examples:
      - "Setiap kali kalian beli Starbucks, pasti salah tulis nama. Apakah ini kebetulan atau strategi marketing?"

  observation_analysis:
    template: "Setiap kali [pattern_observation], [follow_up_pattern]. Kenapa [analytical_question]?"
    structure: "observation + pattern + multiple explanations"
    guardrails:
      - provide_research_backing
      - offer_multiple_perspectives
    examples:
      - "Setiap kali Indomaret buka, pasti ada supermarket lain di dekat. Kenapa kompetitor selalu berdekatan?"

  promise_delivery:
    template: "ini cara kalian [achieve_goal] tanpa [constraint]"
    structure: "promise + validation + detailed strategies + examples"
    guardrails:
      - deliver_on_promises
      - provide_realistic_expectations
    examples:
      - "ini cara kalian dapet 100 customer pertama tanpa keluar duit sepeserpun"

# ENHANCED: Viral hook engine with new archetype support
viral_hook_engine:
  module_id: viral_hook_engine
  enabled: true

  # ENHANCED: Hook archetype pool with new viral patterns
  hook_archetype_pool:
    source: "HOOK_PACK.yaml#exports.hook_pool_ref"
    
    # Optimized archetype weights for viral business scripts
    enhanced_weights:
      # Viral script optimized archetypes (high performance)
      authority: 0.18  # Credibility establishment for business education
      comparison: 0.15  # Value analysis and price psychology
      pattern_recognition: 0.12  # Educational psychology and rule of three
      solution: 0.15  # Practical methodology and no-cost strategies
      
      # Traditional high performers
      curiosity: 0.15  # Conspiracy revealing and mystery building
      counter_intuitive: 0.10  # Myth busting and revelation sharing
      
      # Moderate performers
      revelation: 0.08  # Personal discovery sharing
      stat_shock: 0.05  # Data-driven insights
      list: 0.02  # Simplified for viral content focus
      
      # Minimized for viral focus
      warning: 0.00  # Removed - negative framing reduces viral potential
      promise: 0.00  # Removed - compliance issues with guarantees

  psychological_triggers:
    cognitive_dissonance:
      - pattern: Dulu gue [belief], ternyata [opposite_reality]
      activation: when topic involves mindset/belief change

    authority_questioning:
      - pattern: Yang [authority_figure] gak mau kalian tau tentang [topic]
      activation: when topic involves industry/institutional critique

    social_proof_challenge:
      - pattern: Everyone's doing [trend] wrong, ini cara yang bener
      activation: when topic involves popular practices

    group_identity_threat:
      - pattern: Gen Z yang masih [assumption] perlu denger ini
      activation: when topic involves generational commentary

    # Viral script psychological triggers (optimized)
    experience_authority:
    - pattern: "Aku pernah [experience] di [context] dan [insight]"
    activation: "authority_establishment_needed"
      viral_potential: "high"
      educational_value: "high"

    conspiracy_curiosity:
      - pattern: "Apakah [common_experience] ini [coincidence] atau [strategy]?"
      activation: "business_tactic_revelation_needed"
    viral_potential: "very_high"
    educational_value: "high"

    competitive_observation:
      - pattern: "Setiap kali [brand_a] [action], pasti [brand_b] [reaction]"
      activation: "competitive_analysis_needed"
      viral_potential: "high"
      educational_value: "very_high"

fallback_chain:
  module_id: fallback_chain
  enabled: true

  primary_fallbacks:
    style_fusion_failure:
      condition: fusion_feels_unnatural_or_forced
      action: revert_to_single_creator_style

    overlong_block:
      condition: block_duration_seconds > 5
      action: auto_split_into_≤5s

  secondary_fallbacks:
    missing_citation:
      condition: claim_requires_citation && citation_missing
      action: downgrade_claim_to_soft_language

emotional_valley:
  enabled: true
  profile_ref: CORE_PACK.yaml#emotional_glide_engine.glide_profiles.default_valley
  enforce_mid_segment: true
  outputs:
    - valley_start
    - reflection_hint

visual_sync_mapper:
  enabled: true

edu_mode_engine:
  triggers:
    - topic:
        - AI
        - sains
        - sistem kerja
        - teknologi masa depan
        - FMCG strategies  # NEW
        - competitive analysis  # NEW
        - brand positioning  # NEW
  tone: reflektif
  behavior:
    - prioritize_fact_check: true
    - simplify_language: true
    - emphasize_learning: true

fomo_controversy_engine:
  module_id: fomo_controversy_engine
  enabled: true

  debate_starters:
    - Kubu A bilang [X], kubu B bilang [Y] — mana yang bener?
    - Kalau kalian di posisi [role], milih [option1] atau [option2]?
    # NEW: Business-focused debate starters
    - Pedro vs Charles Enquete, kalian tim mana sebelum tau mereka satu boss?
    - Starbucks salah tulis nama: kebetulan atau strategi genius?

  guardrails:
    - no_personal_attack
    - avoid_false_dichotomy
    - cite_before_spice

# ENHANCED: Deep research engine with viral business categories  
deep_research_engine:
  module_id: comprehensive_research_pipeline
  enabled: true
  activation_trigger: post_fact_verification_success
  priority: CRITICAL_CONTENT_ENRICHMENT

  min_citations_required:
    basic: 3
    comprehensive: 7
    expert: 12

  citations_output:
    format: bulleted_links
    require_domains_note: true

  inputs:
    required:
      - topic
      - draft_script
      - locale

  research_depth_auto_selection:
    basic_research:
      trigger_conditions:
        - simple_topics_with_clear_context
        - well_established_facts
        - non_controversial_subjects
      sources_target: 3_to_5_sources

    comprehensive_research:
      trigger_conditions:
        - complex_technical_topics
        - trending_controversial_issues
        - health_medical_information
        - financial_economic_topics
        # NEW: Viral business contexts
        - competitive_strategy_analysis
        - brand_positioning_claims
        - marketing_psychology_theories
      sources_target: 8_to_12_sources

    expert_level_research:
      trigger_conditions:
        - breaking_news_developments
        - scientific_research_topics
        - legal_regulatory_matters
        - policy_government_issues
        # NEW: Authority establishment needs
        - FMCG_industry_claims
        - corporate_experience_verification
      sources_target: 15_plus_sources

  source_scoring:
    weights:
      author_reputation: 0.35
      domain_authority: 0.25
      recency: 0.25
      cross_corroboration: 0.15

    domain_priority:
      - primary_sources
      - peer_reviewed
      - standards_bodies
      - gov
      - reputable_media
      - industry_publications  # NEW
      - business_case_studies  # NEW
      - aggregators

    banned_sources:
      - random_forums
      - uncited_tweets

  recency_windows_days:
    default: 365
    ai: 180
    finance: 90
    health: 730
    # NEW: Business contexts
    marketing_trends: 180
    competitive_intelligence: 90
    brand_case_studies: 730

  retrieval_policy:
    max_sources: 12
    dedupe_by: canonical_url_hash
    language_bias:
      - id
      - en

  contradiction_detection:
    enabled: true
    strategies:
      - multi_source_crosscheck
      - claim_vote
      - minority_report
    resolution_order:
      - primary_sources
      - peer_reviewed
      - official_statement
      - consensus_media

  citation_policy:
    min_citations: 3
    include_urls: true
    format: author_or_org, title, year

  normalizer_fields:
    - source
    - title
    - url
    - date
    - type

  outputs_contract:
    keys:
      - research_summary
      - citations
      - confidence_score
      - claim_register

  # ENHANCED: Claim register with viral script business categories
  claim_register:
    schema:
      id: string
      text: string
      type: fact|opinion|prediction
      status: verified|refuted|uncertain
      evidence_ids: list
      confidence: 0..1

    # Enhanced business claim categories for viral scripts
    # Streamlined business claim categories for viral scripts
  business_claim_categories:
      viral_business_metrics:
        - pricing_psychology_examples
        - conversion_rate_improvements  
        - engagement_rate_increases
        - customer_acquisition_results
        enforcement: "frame_as_case_studies_with_context"
        disclaimer_required: true
        
      authority_experience_claims:
        - corporate_work_experience
        - industry_insider_knowledge
        - specific_company_insights
        - professional_background_validation
        enforcement: "personal_experience_framing_only"
        verification_level: "general_principles_not_confidential_info"
        
      competitive_analysis_claims:
        - business_relationship_revelations
        - market_strategy_observations
        - brand_positioning_analysis
        - industry_pattern_recognition
        enforcement: "public_information_based_analysis_only"
        speculation_handling: "frame_as_observation_not_fact"

      # Consolidated viral script claim categories
      viral_education_claims:
        - retail_psychology_examples
        - consumer_behavior_insights
        - marketing_tactic_revelations
        - business_strategy_observations
        enforcement: "educational_framing_with_research_backing"
        balance_requirement: "provide_alternative_explanations"
        conspiracy_handling: "present_as_analysis_not_definitive_fact"

  handoff:
    to_hook_generator: research_insights_inform_viral_hook_creation
    to_narrative_consistency_enforcer: numbers_and_entities_locked
    to_style_fusion: domain_persona_bias_adjusted_by_research_depth

  metrics:
    hallucination_risk_score: 0..1

  invariants:
    - citation_policy.min_citations >= 3
    - 0.0 <= confidence_score <= 1.0

  smart_search_query_builder:
    enabled: true
    patterns:
      - '{topic} Indonesian context'
      - '{topic} data 2023..now'
      - '{topic} expert critique'
      # Viral script research patterns (optimized)
      - '{brand_name} marketing strategy Indonesia'
      - '{retail_psychology} consumer behavior Southeast Asia'
      - '{competitive_strategy} business analysis public information'
    output:
      queries: 7  # Increased from 5

  evidence_distiller:
    enabled: true
    rules:
      - prefer_primary_sources
      - triangulate_at_least: 3
      # Viral business script rules (streamlined)
      - verify_business_claims_via_public_sources
      - maintain_educational_focus_over_sensationalism
    outputs:
      - distilled_facts
      - citations_list

  research_engine_integration:
    handoff_protocols:
      from_fact_verification: verified_content_becomes_research_foundation
      to_hook_generator: research_insights_inform_viral_hook_creation
      to_style_fusion: research_depth_influences_creator_selection
      to_script_structure: research_synthesis_shapes_content_organization

    performance_optimization:
      research_caching: reuse_insights_within_session_only
      source_prioritization: rank_sources_by_reliability_and_viral_potential
      insight_extraction: automated_viral_angle_identification
      cultural_adaptation: automatic_indonesian_context_integration

  validation_tags:
    - deep_research_engine_active
    - multi_source_research_complete
    - indonesian_context_integrated
    - viral_angles_identified
    - educational_value_confirmed
    - viral_script_compatibility_verified

modules:
  - name: hook_generator
    function: Generates culturally grounded hook lines with viral script compatibility
    depends_on: []

  - name: emotional_pacer
    function: Modulates emotional pacing across segments
    depends_on:
      - hook_generator

  - name: style_imprinter
    function: Applies creator style DNA to script with viral tone support
    depends_on:
      - hook_generator

  - name: tone_shifter
    function: Adjusts tone transitions per segment including viral script tones
    depends_on:
      - emotional_pacer
      - style_imprinter

  - name: visual_sync_mapper
    function: Aligns script segments to visual beat timing
    depends_on:
      - tone_shifter

  - name: emotional_glide_engine
    function: Controls micro-emotional transitions within segments
    depends_on:
      - emotional_pacer
      - tone_shifter

  - name: validator_interface
    function: Ensures output meets all QA, safety, and engagement standards
    depends_on:
      - hook_generator
      - style_imprinter
      - emotional_pacer
      - tone_shifter

  - name: fallback_tone_handler
    function: Fallback engine when tone/style mismatch detected
    depends_on:
      - validator_interface

  - name: twist_optimizer
    function: Ensures narrative twists follow emotional & logical arc
    depends_on:
      - emotional_pacer
      - tone_shifter

  - name: thumbnail_emotion_checker
    function: Verifies thumbnail tone alignment to script content
    depends_on:
      - hook_generator
      - emotional_glide_engine

  - name: edu_mode_engine
    function: Adjusts content style to reflective educational tone when triggered
    depends_on:
      - hook_generator
      - style_imprinter

  - name: narrative_consistency_enforcer
    function: Ensures logical coherence and segment consistency across script
    depends_on:
      - hook_generator
      - tone_shifter
      - style_imprinter

module_index:
  hook_generator: '*modules[name=hook_generator]'
  visual_sync_mapper: '*modules[name=visual_sync_mapper]'
  narrative_consistency_enforcer: '*modules[name=narrative_consistency_enforcer]'
  emotional_glide_engine: '*modules[name=emotional_glide_engine]'
  viral_hook_engine: '*modules[name=viral_hook_engine]'
  fomo_controversy_engine: '*modules[name=fomo_controversy_engine]'
  deep_research_engine: '*modules[name=deep_research_engine]'
  edu_mode_engine: '*modules[name=edu_mode_engine]'

emotional_glide_engine:
  aliases:
    strong_valley: valley_to_climax

  glide_profiles:
    default_valley:
      phases:
        - burst
        - hold
        - glide
      valley_window: 30s–45s

    shock:
      pattern: burst→hold

    awe:
      pattern: hold→glide

    curiosity:
      pattern: explain→anchor

    melancholy:
      pattern: drift→pause

    intrigue:
      pattern: tease→punch

    valley_to_climax:
      pattern: valley→rise→climax

    # NEW: Viral script emotional patterns
    authority_establishment:
      pattern: credibility→confidence→delivery

    conspiracy_revelation:
      pattern: mystery→buildup→reveal

    competitive_analysis:
      pattern: observation→investigation→insight

  modulation_rules:
    intensity_modulation:
      based_on:
        - perceived_retention_cues
        - segment_emotion_score
      action: adjust_segment_pacing_and_music_cue

  visual_transition_support:
    use_overlay: true
    transition_styles:
      - fade-in
      - flash-cut
      - zoom

  audio_support:
    use_ambient_emotion: true
    cue_library:
      - hope
      - tension
      - resolution
      - mystery
      # NEW: Viral script audio cues
      - authority
      - revelation
      - conspiracy
      - competitive_insight

  activation_conditions:
    - narrative shift detected between segments
    - emotional contrast > 0.4 threshold
    - CTA type requires emotional ramp-up
    # NEW: Viral script activation conditions
    - authority_establishment_needed
    - conspiracy_reveal_pattern_detected
    - competitive_analysis_mode_active

  validation_tags:
    - emotional_shift_consistency
    - glide_duration_tuning
    - audio_visual_support_alignment
    - transition_type_match
    - viral_script_emotional_compatibility

microblock:
  split_rules:
    default_max_seconds: 5
    long_mode_max_seconds: 8
    # NEW: Viral script specific rules
    authority_establishment_max_seconds: 6
    conspiracy_reveal_max_seconds: 7

  segmentation_policy:
    - keep_semantic_units: true
    - avoid_mid_sentence_splits: true
    - prefer_cut_on_breath: true
    # NEW: Viral script segmentation
    - preserve_authority_statements: true
    - maintain_conspiracy_buildup_flow: true

  id_format: 'HOOK-A1|BODY-A1a|PEAK-A1'

  validation:
    - use: RUNTIME_QUALITY.validators.structure_language_enforcer